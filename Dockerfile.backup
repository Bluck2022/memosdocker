FROM alpine:3.20

ENV TZ=Asia/Shanghai
RUN apk add --no-cache mysql-client dcron tzdata ca-certificates curl && \
    ARCH=$(uname -m) && \
    if [ "$ARCH" = "aarch64" ]; then ARCH="arm64"; fi && \
    if [ "$ARCH" = "x86_64" ]; then ARCH="amd64"; fi && \
    curl -Lo /usr/local/bin/rclone \
      "https://downloads.rclone.org/v1.70.3/linux-${ARCH}/rclone-v1.70.3-linux-${ARCH}" && \
    chmod +x /usr/local/bin/rclone

COPY backup.sh /backup.sh
RUN chmod +x /backup.sh

# 每天 03:00 执行一次
RUN echo '0 3 * * * /backup.sh >>/var/log/cron.log 2>&1' | crontab -
CMD ["crond", "-f"]
